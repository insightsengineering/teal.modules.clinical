<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="teal.modules.clinical">
<title>Quick start: `substitute` for NSE â€¢ teal.modules.clinical</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Quick start: `substitute` for NSE">
<meta property="og:description" content="teal.modules.clinical">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">teal.modules.clinical</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.16.9062</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/teal-modules-clinical.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/generate_tmc_test_data.html">Example Data Generation</a>
    <a class="dropdown-item" href="../articles/quickstart_substitute.html">Quick start: `substitute` for NSE</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-reports">Reports</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-reports">
    <a class="dropdown-item" href="../coverage-report/">Coverage report</a>
    <a class="dropdown-item" href="../unit-test-report/">Unit test report</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/insightsengineering/teal.modules.clinical">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Quick start: `substitute` for NSE</h1>
                        <h4 data-toc-skip class="author">Francois
Collin</h4>
            
            <h4 data-toc-skip class="date">29.10.2020</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/teal.modules.clinical/blob/HEAD/vignettes/quickstart_substitute.Rmd" class="external-link"><code>vignettes/quickstart_substitute.Rmd</code></a></small>
      <div class="d-none name"><code>quickstart_substitute.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="section"></h3>
<p>Considering an expression, R usually evaluates it and returns its
value. Instead of focusing on the value, it is also possible to work
with the <strong>code</strong> which generated the
<strong>value</strong>. This is where non standard evaluation, or NSE,
starts. The function <code>substitute</code> is an important element of
non-standard evaluation. For instance, if we consider <code>a</code>
defined such as <code>a &lt;- 5</code>, then the expression
<code>a</code> returns 5, the <code>substitute(a)</code> returns the
code to obtain the value: <code>a</code>.</p>
<p>This is the principle <code>teal</code> relies on to:</p>
<ol style="list-style-type: lower-roman">
<li>generate expressions.</li>
<li>return the result of the expression in the result panel of the
app.</li>
<li>return the corresponding code (or expression) with
<code>Show R Code</code>.</li>
</ol>
<p>The expression returning the displayed value must be reactive. The
information in the encoding in one hand and the filtering panel on the
other hand modify the expression and the displayed value. As such,
<code>teal</code> needs to work both on expressions and values and
relies heavily on NSE.</p>
<p>The NSE is an advanced notion and mixing it with Shiny app
development is a source of difficulties such as:</p>
<ul>
<li>hindered coding efficiency as the Shiny app must be run in order to
check the correct execution of the code.</li>
<li>limited possibilities for testing.</li>
</ul>
<p>As an alternative, it is possible to focus first on the NSE aspects
in plain R, and only once ready, integrate it in the Shiny App. The
following are a few practical examples demonstrating how NSE works. The
choice was made to focus on <code>substitute</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="the-basics">The Basics<a class="anchor" aria-label="anchor" href="#the-basics"></a>
</h2>
<div class="section level3">
<h3 id="nse-principle">NSE Principle<a class="anchor" aria-label="anchor" href="#nse-principle"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">non_evaluated_expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span></span>
<span><span class="va">non_evaluated_expression</span></span>
<span><span class="co">## a + b</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">non_evaluated_expression</span><span class="op">)</span></span>
<span><span class="co">## Error in eval(non_evaluated_expression): object 'b' not found</span></span></code></pre></div>
<p>What happened?</p>
<ul>
<li>
<code>substitute</code> returns the code and not the value,</li>
<li>it does not attempt to run the code, therefore it is possible to
return an expression which does not make sense (yet), for instance
involving two non defined objects.</li>
<li>If the values of <code>a</code> and <code>b</code> exist, the
expression can run without error:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">non_evaluated_expression</span><span class="op">)</span></span>
<span><span class="co">## [1] 6</span></span></code></pre></div>
<p>Now, the function name <code>substitute</code> is for a reason. Not
only returning the expression, it also <strong>operates
substitutions</strong> of some terms within a given expression.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">b</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span>expr <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">non_evaluated_expression</span> <span class="op">&lt;-</span> <span class="fu">fun</span><span class="op">(</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">non_evaluated_expression</span></span>
<span><span class="co">## 5 + -2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">non_evaluated_expression</span><span class="op">)</span></span>
<span><span class="co">## [1] 3</span></span></code></pre></div>
<p>What happened?</p>
<ul>
<li>the objects <code>a</code> and <code>b</code> exist in the function
environment where <code>substitute</code> is called.</li>
<li>the terms of the expression within <code>substitute</code> were
replaced by the values of <code>a</code> and <code>b</code>.</li>
</ul>
<p>Indeed, before returning the expression, <code>substitute</code>
verifies if <code>a</code> and <code>b</code> donâ€™t have any value
existing in the evaluation environment. If so, values of <code>a</code>
and <code>b</code> are used in the expression.</p>
<p>It is also possible to use the second argument of
<code>substitute</code>, <code>env</code>, an environment (or a list)
containing objects. If the expression submitted in
<code>substitute</code> has corresponding objects in <code>env</code>,
the terms within the expression will be substituted with provided
values:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">non_evaluated_expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="va">a</span> <span class="op">+</span> <span class="va">b</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">5</span>, b <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">non_evaluated_expression</span></span>
<span><span class="co">## 5 + 5</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">non_evaluated_expression</span><span class="op">)</span></span>
<span><span class="co">## [1] 10</span></span></code></pre></div>
<p>What happened?</p>
<ul>
<li>The environment in which the values of <code>a</code> and
<code>b</code> were taken from was directly declared within the
<code>substitute</code> expression (argument <code>expr</code>) and the
values were substituted (argument <code>env</code>).</li>
<li>
<code>substitute</code> returned a non-evaluated expression, use
<code><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval()</a></code> to evaluate it.</li>
</ul>
<p>With a slightly more elaborate expression:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">non_evaluated_expression</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, main <span class="op">=</span> <span class="va">text</span><span class="op">)</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, text <span class="op">=</span> <span class="st">"A graph"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">non_evaluated_expression</span></span>
<span><span class="co">## plot(x = 0:10, y = exp(0:10), main = "A graph")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">non_evaluated_expression</span><span class="op">)</span></span></code></pre></div>
<p><img src="quickstart_substitute_files/figure-html/unnamed-chunk-6-1.svg" width="700"></p>
<p>Note that:</p>
<ul>
<li>
<code>x</code> as an argument name in plot has been preserved, while
<code>x</code> as an object has been replaced.</li>
</ul>
</div>
<div class="section level3">
<h3 id="replace-an-object-name">Replace an object name<a class="anchor" aria-label="anchor" href="#replace-an-object-name"></a>
</h3>
<p>In formulas, character strings are not accepted, how do we execute
the substitution?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Error expected:</span></span>
<span><span class="va">plot_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span>, main <span class="op">=</span> <span class="va">text</span><span class="op">)</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">Sepal.Length</span>,</span>
<span>    y <span class="op">=</span> <span class="va">Sepal.Width</span>,</span>
<span>    text <span class="op">=</span> <span class="st">"Iris, again ..."</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Error in eval(expr, envir, enclos): object 'Sepal.Length' not found</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Error expected:</span></span>
<span><span class="va">plot_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span>, main <span class="op">=</span> <span class="va">text</span><span class="op">)</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Sepal.Length"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Sepal.Width"</span>,</span>
<span>    text <span class="op">=</span> <span class="st">"Iris, again ..."</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plot_expr</span></span>
<span><span class="co">## plot("Sepal.Width" ~ "Sepal.Length", data = iris, main = "Iris, again ...")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">plot_expr</span><span class="op">)</span></span>
<span><span class="co">## Error in terms.formula(formula, data = data): invalid term in model formula</span></span></code></pre></div>
<p>The object names have a specific <em>class</em> (<code>name</code>);
<code>as.names</code> coerces a character string to an object name
(alternatively, <code>as.symbol</code> provides an identical
result):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">iris</span>, main <span class="op">=</span> <span class="va">text</span><span class="op">)</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.symbol</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span>,</span>
<span>    text <span class="op">=</span> <span class="st">"Iris, again ..."</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plot_expr</span></span>
<span><span class="co">## plot(Sepal.Width ~ Sepal.Length, data = iris, main = "Iris, again ...")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">plot_expr</span><span class="op">)</span></span></code></pre></div>
<p><img src="quickstart_substitute_files/figure-html/unnamed-chunk-9-1.svg" width="700"></p>
</div>
<div class="section level3">
<h3 id="what-about-dataframe-names">What about dataframe names?<a class="anchor" aria-label="anchor" href="#what-about-dataframe-names"></a>
</h3>
<p>Lets imagine a pipe-flavored expression, with <code>df</code> being
the term corresponding to the dataframe which should be substituted:
<code>df %&gt;% plot(y ~ x, data = ., main = text)</code>.</p>
<p>The principle exposed above can work directly without addition.
However, <code>df</code> in the expression is then replaced directly by
the value of the object provided and not the expression generating the
dataframe: the pipeline is working but not humanly readable.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span>
<span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span>
<span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span>
<span></span>
<span><span class="va">short_iris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span><span class="va">plot_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">.</span>, main <span class="op">=</span> <span class="va">text</span><span class="op">)</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="va">short_iris</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.symbol</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span>,</span>
<span>    text <span class="op">=</span> <span class="st">"Iris, again ..."</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">plot_expr</span><span class="op">)</span></span></code></pre></div>
<p><img src="quickstart_substitute_files/figure-html/unnamed-chunk-10-1.svg" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_expr</span></span>
<span><span class="co">## list(Sepal.Length = c(5.1, 4.9, 4.7, 4.6, 5, 5.4), Sepal.Width = c(3.5, </span></span>
<span><span class="co">## 3, 3.2, 3.1, 3.6, 3.9), Petal.Length = c(1.4, 1.4, 1.3, 1.5, </span></span>
<span><span class="co">## 1.4, 1.7), Petal.Width = c(0.2, 0.2, 0.2, 0.2, 0.2, 0.4), Species = c(1L, </span></span>
<span><span class="co">## 1L, 1L, 1L, 1L, 1L)) %&gt;% plot(Sepal.Width ~ Sepal.Length, data = ., </span></span>
<span><span class="co">##     main = "Iris, again ...")</span></span></code></pre></div>
<p>How can we replace the value by the expression generating this
value?</p>
<p>That is pretty much the topic of the vignette:
<code>substitute</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">.</span>, main <span class="op">=</span> <span class="va">text</span><span class="op">)</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span>,</span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.name</a></span><span class="op">(</span><span class="st">"Sepal.Length"</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/name.html" class="external-link">as.symbol</a></span><span class="op">(</span><span class="st">"Sepal.Width"</span><span class="op">)</span>,</span>
<span>    text <span class="op">=</span> <span class="st">"Iris, again ..."</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">plot_expr</span></span>
<span><span class="co">## iris %&gt;% plot(Sepal.Width ~ Sepal.Length, data = ., main = "Iris, again ...")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">plot_expr</span><span class="op">)</span></span></code></pre></div>
<p><img src="quickstart_substitute_files/figure-html/unnamed-chunk-11-1.svg" width="700"></p>
</div>
<div class="section level3">
<h3 id="in-a-nutshell">In a nutshell<a class="anchor" aria-label="anchor" href="#in-a-nutshell"></a>
</h3>
<ul>
<li>
<code>substitute</code> is relevant when the expression needs to be
modified. It takes 2 arguments:
<ul>
<li>
<code>expr</code> the expression to be (eventually)
substituted.</li>
<li>
<code>env</code> the environment in which potential replacement
value might be needed.</li>
</ul>
</li>
<li>If the replacement value should be slightly more special like:
<ul>
<li>an <strong>object name</strong> (like in formulas
e.g.Â <code>y ~ x</code>) then, use <code>as.name</code> or
<code>as.symbol</code>.</li>
<li>a <strong>data frame</strong> name (like <code>iris</code>) then,
use <code>substitute</code>.</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="rtables">
<code>rtables</code><a class="anchor" aria-label="anchor" href="#rtables"></a>
</h2>
<div class="section level3">
<h3 id="direct-use-of-substitute">Direct use of <code>substitute</code><a class="anchor" aria-label="anchor" href="#direct-use-of-substitute"></a>
</h3>
<p>The <code>substitute</code> approach can be used with the
<code>rtables</code> pipelines.</p>
<p>Lets prepare an example for reporting data from the LB domain. The
example is based on the template <code>LBT01</code>; the target is to
report in columns the lab test result per study arm, as values
(<code>AVAL</code>) and changes from baseline (<code>CHG</code>), per
analysis visit in rows.</p>
<p>The data can be prepared as follows:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/rtables" class="external-link">rtables</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/tern" class="external-link">tern</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">adlb</span> <span class="op">&lt;-</span> <span class="fu">teal.modules.clinical</span><span class="fu">::</span><span class="va"><a href="../reference/ex_data.html">tmc_ex_adlb</a></span></span>
<span><span class="va">adlb_f</span> <span class="op">&lt;-</span> <span class="va">adlb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">PARAM</span> <span class="op">==</span> <span class="st">"Alanine Aminotransferase Measurement"</span> <span class="op">&amp;</span></span>
<span>      <span class="va">ARMCD</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM A"</span>, <span class="st">"ARM B"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"WEEK 1 DAY 8"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>And the <code>rtables</code> expression is obtained as:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rtables_expr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>  expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html" class="external-link">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html" class="external-link">split_cols_by</a></span><span class="op">(</span><span class="va">arm</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="va">visit</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by_multivar.html" class="external-link">split_cols_by_multivar</a></span><span class="op">(</span></span>
<span>      vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AVAL"</span>, <span class="st">"CHG"</span><span class="op">)</span>,</span>
<span>      varlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Value"</span>, <span class="st">"Change"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/tern/man/summarize_colvars.html" class="external-link">summarize_colvars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html" class="external-link">build_table</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df</span><span class="op">)</span>,</span>
<span>  env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">adlb_f</span><span class="op">)</span>,</span>
<span>    arm <span class="op">=</span> <span class="st">"ARM"</span>,</span>
<span>    visit <span class="op">=</span> <span class="st">"AVISIT"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The expression is valid â€¦ :</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">rtables_expr</span><span class="op">)</span></span>
<span><span class="co">##                        A: Drug X                    B: Placebo        </span></span>
<span><span class="co">##                   Value         Change         Value         Change   </span></span>
<span><span class="co">## â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></span>
<span><span class="co">## WEEK 1 DAY 8                                                          </span></span>
<span><span class="co">##   n                69             69            73             73     </span></span>
<span><span class="co">##   Mean (SD)    20.8 (4.1)     1.6 (6.1)     20.2 (4.1)     -0.2 (5.6) </span></span>
<span><span class="co">##   Median          20.4           2.4           20.0           -0.2    </span></span>
<span><span class="co">##   Min - Max    12.8 - 34.6   -11.3 - 14.2   12.6 - 29.0   -12.8 - 10.8</span></span></code></pre></div>
<p>â€¦ but not easily readable â€¦:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rtables_expr</span></span>
<span><span class="co">## basic_table() %&gt;% split_cols_by("ARM", split_fun = drop_split_levels) %&gt;% </span></span>
<span><span class="co">##     split_rows_by("AVISIT", split_fun = drop_split_levels) %&gt;% </span></span>
<span><span class="co">##     split_cols_by_multivar(vars = c("AVAL", "CHG"), varlabels = c("Value", </span></span>
<span><span class="co">##         "Change")) %&gt;% summarize_colvars() %&gt;% build_table(df = adlb_f)</span></span></code></pre></div>
<p>â€¦ but that can be arranged:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/teal/" class="external-link">teal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lib/styler" class="external-link">styler</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#' Stylish code</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Deparse an expression and display the code following NEST conventions.</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @param expr (`call`)\cr or possibly understood as so.</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">styled_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">expr</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span>    <span class="fu">styler</span><span class="fu">::</span><span class="fu"><a href="https://styler.r-lib.org/reference/style_text.html" class="external-link">style_text</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse</a></span><span class="op">(</span><span class="va">expr</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    colored <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="fu">styled_expr</span><span class="op">(</span><span class="va">rtables_expr</span><span class="op">)</span></span>
<span><span class="co">## basic_table() %&gt;%</span></span>
<span><span class="co">##   split_cols_by("ARM", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_rows_by("AVISIT", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_cols_by_multivar(vars = c("AVAL", "CHG"), varlabels = c(</span></span>
<span><span class="co">##     "Value",</span></span>
<span><span class="co">##     "Change"</span></span>
<span><span class="co">##   )) %&gt;%</span></span>
<span><span class="co">##   summarize_colvars() %&gt;%</span></span>
<span><span class="co">##   build_table(df = adlb_f)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="substitute-in-a-function">
<code>substitute</code> in a function<a class="anchor" aria-label="anchor" href="#substitute-in-a-function"></a>
</h3>
<p>Moving further, <code>substitute</code> can actually be wrapped in a
function, this way the <code>rtables</code> pipelines are
<em>programmatically</em> obtained:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rtables_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,</span>
<span>                         <span class="va">arm</span>,</span>
<span>                         <span class="va">visit</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>    expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html" class="external-link">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html" class="external-link">split_cols_by</a></span><span class="op">(</span><span class="va">arm</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="va">visit</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by_multivar.html" class="external-link">split_cols_by_multivar</a></span><span class="op">(</span></span>
<span>        vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AVAL"</span>, <span class="st">"CHG"</span><span class="op">)</span>,</span>
<span>        varlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Value"</span>, <span class="st">"Change"</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/tern/man/summarize_colvars.html" class="external-link">summarize_colvars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html" class="external-link">build_table</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df</span><span class="op">)</span>,</span>
<span>    env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>      arm <span class="op">=</span> <span class="va">arm</span>,</span>
<span>      visit <span class="op">=</span> <span class="va">visit</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">rtables_expr</span><span class="op">(</span>df <span class="op">=</span> <span class="va">adlb_f</span>, arm <span class="op">=</span> <span class="st">"ARM"</span>, visit <span class="op">=</span> <span class="st">"AVISIT"</span><span class="op">)</span></span>
<span><span class="fu">styled_expr</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">## basic_table() %&gt;%</span></span>
<span><span class="co">##   split_cols_by("ARM", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_rows_by("AVISIT", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_cols_by_multivar(vars = c("AVAL", "CHG"), varlabels = c(</span></span>
<span><span class="co">##     "Value",</span></span>
<span><span class="co">##     "Change"</span></span>
<span><span class="co">##   )) %&gt;%</span></span>
<span><span class="co">##   summarize_colvars() %&gt;%</span></span>
<span><span class="co">##   build_table(df = adlb_f)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">##                        A: Drug X                    B: Placebo        </span></span>
<span><span class="co">##                   Value         Change         Value         Change   </span></span>
<span><span class="co">## â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></span>
<span><span class="co">## WEEK 1 DAY 8                                                          </span></span>
<span><span class="co">##   n                69             69            73             73     </span></span>
<span><span class="co">##   Mean (SD)    20.8 (4.1)     1.6 (6.1)     20.2 (4.1)     -0.2 (5.6) </span></span>
<span><span class="co">##   Median          20.4           2.4           20.0           -0.2    </span></span>
<span><span class="co">##   Min - Max    12.8 - 34.6   -11.3 - 14.2   12.6 - 29.0   -12.8 - 10.8</span></span></code></pre></div>
<ul>
<li>The same results as before are obtained â€¦</li>
<li>while, fine tuning is easier.</li>
<li>For instance, the variable designating the study arm and the visit
can be changed, which is an expected feature in teal module encoding
panel.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">rtables_expr</span><span class="op">(</span>df <span class="op">=</span> <span class="va">adlb_f</span>, arm <span class="op">=</span> <span class="st">"ARMCD"</span>, visit <span class="op">=</span> <span class="st">"AVISITN"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">## Split var [AVISITN] was not character or factor. Converting to factor</span></span>
<span><span class="co">##                         ARM A                        ARM B           </span></span>
<span><span class="co">##                  Value         Change         Value         Change   </span></span>
<span><span class="co">## â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></span>
<span><span class="co">## 1                                                                    </span></span>
<span><span class="co">##   n               69             69            73             73     </span></span>
<span><span class="co">##   Mean (SD)   20.8 (4.1)     1.6 (6.1)     20.2 (4.1)     -0.2 (5.6) </span></span>
<span><span class="co">##   Median         20.4           2.4           20.0           -0.2    </span></span>
<span><span class="co">##   Min - Max   12.8 - 34.6   -11.3 - 14.2   12.6 - 29.0   -12.8 - 10.8</span></span>
<span><span class="fu">styled_expr</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">## basic_table() %&gt;%</span></span>
<span><span class="co">##   split_cols_by("ARMCD", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_rows_by("AVISITN", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_cols_by_multivar(vars = c("AVAL", "CHG"), varlabels = c(</span></span>
<span><span class="co">##     "Value",</span></span>
<span><span class="co">##     "Change"</span></span>
<span><span class="co">##   )) %&gt;%</span></span>
<span><span class="co">##   summarize_colvars() %&gt;%</span></span>
<span><span class="co">##   build_table(df = adlb_f)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="chain-expressions-in-a-pipeline">Chain expressions in a pipeline<a class="anchor" aria-label="anchor" href="#chain-expressions-in-a-pipeline"></a>
</h3>
<p>It is also possible to manipulate expressions, for instance,
expressions might be chained in a pipeline.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Expressions as a pipeline</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' Accepts expressions to be chained using the `magrittr` pipeline-flavor.</span></span>
<span><span class="co">#' @param ... (`call`)\cr or object which can be interpreted as so.</span></span>
<span><span class="co">#'    (e.g. `name`)</span></span>
<span><span class="co">#'</span></span>
<span><span class="va">pipe_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">exprs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">exprs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span></span>
<span>    <span class="va">exprs</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">exprs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">exprs</span><span class="op">)</span></span>
<span>  <span class="va">exprs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">exprs</span>, collapse <span class="op">=</span> <span class="st">" %&gt;% "</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/parse.html" class="external-link">str2lang</a></span><span class="op">(</span><span class="va">exprs</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">#' @examples</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipe_expr.html">pipe_expr</a></span><span class="op">(</span></span>
<span>  expr1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>  expr2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">head</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">result</span></span>
<span><span class="co">## df %&gt;% head</span></span></code></pre></div>
<ul>
<li>Expressions can be arranged in a list, this way, it is possible to
have <strong>conditional</strong> editing of expressions.</li>
<li>In the context of <code>rtables</code>, layers enclosing
<code>analyze</code> call handle <code>.stats</code> option. The lean
expression should include the <code>.stats</code> option, <strong>only
when the default value is changed</strong>.</li>
<li>This is again an expected feature in teal module when rendering the
code with <code>Show R Code</code>:</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rtables_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,</span>
<span>                         <span class="va">arm</span>,</span>
<span>                         <span class="va">visit</span>,</span>
<span>                         <span class="va">.stats</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># The rtables layout is decomposed into a list of expressions.</span></span>
<span>  <span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co"># 1. First the columns and rows:</span></span>
<span>  <span class="va">lyt</span><span class="op">$</span><span class="va">structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>    expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html" class="external-link">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html" class="external-link">split_cols_by</a></span><span class="op">(</span><span class="va">arm</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="va">visit</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by_multivar.html" class="external-link">split_cols_by_multivar</a></span><span class="op">(</span></span>
<span>        vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AVAL"</span>, <span class="st">"CHG"</span><span class="op">)</span>,</span>
<span>        varlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Value"</span>, <span class="st">"Change"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      arm <span class="op">=</span> <span class="va">arm</span>,</span>
<span>      visit <span class="op">=</span> <span class="va">visit</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># 2. The analyze layer which depends on the use of .stats.</span></span>
<span>  <span class="va">lyt</span><span class="op">$</span><span class="va">analyze</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">.stats</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/tern/man/summarize_colvars.html" class="external-link">summarize_colvars</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/tern/man/summarize_colvars.html" class="external-link">summarize_colvars</a></span><span class="op">(</span>.stats <span class="op">=</span> <span class="va">.stats</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.stats <span class="op">=</span> <span class="va">.stats</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="co"># 3. And finishing with rtables::build_table.</span></span>
<span>  <span class="va">lyt</span><span class="op">$</span><span class="va">build</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html" class="external-link">build_table</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># As previously demonstrated, expressions can be manipulated and</span></span>
<span>  <span class="co"># chained in a pipeline.</span></span>
<span>  <span class="fu"><a href="../reference/pipe_expr.html">pipe_expr</a></span><span class="op">(</span><span class="va">lyt</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<ul>
<li>First application with standard statistics:</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">rtables_expr</span><span class="op">(</span>df <span class="op">=</span> <span class="va">adlb_f</span>, arm <span class="op">=</span> <span class="st">"ARM"</span>, visit <span class="op">=</span> <span class="st">"AVISIT"</span><span class="op">)</span></span>
<span><span class="fu">styled_expr</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">## basic_table() %&gt;%</span></span>
<span><span class="co">##   split_cols_by("ARM", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_rows_by("AVISIT", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_cols_by_multivar(vars = c("AVAL", "CHG"), varlabels = c(</span></span>
<span><span class="co">##     "Value",</span></span>
<span><span class="co">##     "Change"</span></span>
<span><span class="co">##   )) %&gt;%</span></span>
<span><span class="co">##   summarize_colvars() %&gt;%</span></span>
<span><span class="co">##   build_table(df = adlb_f)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">##                        A: Drug X                    B: Placebo        </span></span>
<span><span class="co">##                   Value         Change         Value         Change   </span></span>
<span><span class="co">## â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></span>
<span><span class="co">## WEEK 1 DAY 8                                                          </span></span>
<span><span class="co">##   n                69             69            73             73     </span></span>
<span><span class="co">##   Mean (SD)    20.8 (4.1)     1.6 (6.1)     20.2 (4.1)     -0.2 (5.6) </span></span>
<span><span class="co">##   Median          20.4           2.4           20.0           -0.2    </span></span>
<span><span class="co">##   Min - Max    12.8 - 34.6   -11.3 - 14.2   12.6 - 29.0   -12.8 - 10.8</span></span></code></pre></div>
<ul>
<li>Then with statistics specifications:</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">rtables_expr</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">adlb_f</span>, arm <span class="op">=</span> <span class="st">"ARM"</span>, visit <span class="op">=</span> <span class="st">"AVISIT"</span>,</span>
<span>  .stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"mean_sd"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">styled_expr</span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">## basic_table() %&gt;%</span></span>
<span><span class="co">##   split_cols_by("ARM", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_rows_by("AVISIT", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_cols_by_multivar(vars = c("AVAL", "CHG"), varlabels = c(</span></span>
<span><span class="co">##     "Value",</span></span>
<span><span class="co">##     "Change"</span></span>
<span><span class="co">##   )) %&gt;%</span></span>
<span><span class="co">##   summarize_colvars(.stats = c("n", "mean_sd")) %&gt;%</span></span>
<span><span class="co">##   build_table(df = adlb_f)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span><span class="co">##                      A: Drug X                B: Placebo       </span></span>
<span><span class="co">##                  Value       Change       Value        Change  </span></span>
<span><span class="co">## â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></span>
<span><span class="co">## WEEK 1 DAY 8                                                   </span></span>
<span><span class="co">##   n                69          69           73           73    </span></span>
<span><span class="co">##   Mean (SD)    20.8 (4.1)   1.6 (6.1)   20.2 (4.1)   -0.2 (5.6)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="including-pre-processing">Including pre-processing<a class="anchor" aria-label="anchor" href="#including-pre-processing"></a>
</h3>
<p>Finally, it would also be possible to wrap several expressions into a
single function.</p>
<ul>
<li>For instance, the teal module generally includes a pre-processing
section:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rtables_expr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>,</span>
<span>                         <span class="va">paramcd</span>,</span>
<span>                         <span class="va">arm</span>,</span>
<span>                         <span class="va">visit</span>,</span>
<span>                         <span class="va">.stats</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># y is a list which will collect two expressions:</span></span>
<span>  <span class="co"># 1. y$data with the preprocessing steps.</span></span>
<span>  <span class="co"># 2. y$rtables the table layout and build.</span></span>
<span>  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co"># 1. Preprocessing ---</span></span>
<span>  <span class="va">y</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>    <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>        <span class="va">PARAMCD</span> <span class="op">==</span> <span class="va">paramcd</span> <span class="op">&amp;</span></span>
<span>          <span class="va">ARMCD</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ARM A"</span>, <span class="st">"ARM B"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"WEEK 1 DAY 8"</span></span>
<span>      <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span>
<span>      paramcd <span class="op">=</span> <span class="va">paramcd</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="co"># 2. rtables layout ---</span></span>
<span>  <span class="va">lyt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="va">lyt</span><span class="op">$</span><span class="va">structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>    expr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/basic_table.html" class="external-link">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by.html" class="external-link">split_cols_by</a></span><span class="op">(</span><span class="va">arm</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="va">visit</span>, split_fun <span class="op">=</span> <span class="va">drop_split_levels</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/split_cols_by_multivar.html" class="external-link">split_cols_by_multivar</a></span><span class="op">(</span></span>
<span>        vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AVAL"</span>, <span class="st">"CHG"</span><span class="op">)</span>,</span>
<span>        varlabels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Value"</span>, <span class="st">"Change"</span><span class="op">)</span></span>
<span>      <span class="op">)</span>,</span>
<span>    env <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      arm <span class="op">=</span> <span class="va">arm</span>,</span>
<span>      visit <span class="op">=</span> <span class="va">visit</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">lyt</span><span class="op">$</span><span class="va">analyze</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">.stats</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/tern/man/summarize_colvars.html" class="external-link">summarize_colvars</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/tern/man/summarize_colvars.html" class="external-link">summarize_colvars</a></span><span class="op">(</span>.stats <span class="op">=</span> <span class="va">.stats</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>.stats <span class="op">=</span> <span class="va">.stats</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">lyt</span><span class="op">$</span><span class="va">build</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/rtables/man/build_table.html" class="external-link">build_table</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">df</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">y</span><span class="op">$</span><span class="va">rtables</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pipe_expr.html">pipe_expr</a></span><span class="op">(</span><span class="va">lyt</span><span class="op">)</span></span>
<span>  <span class="co"># Finally returns y as a list with two expressions.</span></span>
<span>  <span class="va">y</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>It is now possible to modify the studied parameter
(<code>PARAMCD</code>) in addition to the study arm and visit variables
names.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adlb</span> <span class="op">&lt;-</span> <span class="fu">teal.modules.clinical</span><span class="fu">::</span><span class="va"><a href="../reference/ex_data.html">tmc_ex_adlb</a></span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">rtables_expr</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">adlb</span>, paramcd <span class="op">=</span> <span class="st">"CRP"</span>, arm <span class="op">=</span> <span class="st">"ARM"</span>, visit <span class="op">=</span> <span class="st">"AVISIT"</span>,</span>
<span>  .stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"mean_sd"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The two expressions are consistent:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">styled_expr</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">## adlb &lt;- adlb %&gt;% filter(PARAMCD == "CRP" &amp; ARMCD %in% c(</span></span>
<span><span class="co">##   "ARM A",</span></span>
<span><span class="co">##   "ARM B"</span></span>
<span><span class="co">## ) &amp; AVISIT == "WEEK 1 DAY 8")</span></span>
<span><span class="fu">styled_expr</span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">rtables</span><span class="op">)</span></span>
<span><span class="co">## basic_table() %&gt;%</span></span>
<span><span class="co">##   split_cols_by("ARM", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_rows_by("AVISIT", split_fun = drop_split_levels) %&gt;%</span></span>
<span><span class="co">##   split_cols_by_multivar(vars = c("AVAL", "CHG"), varlabels = c(</span></span>
<span><span class="co">##     "Value",</span></span>
<span><span class="co">##     "Change"</span></span>
<span><span class="co">##   )) %&gt;%</span></span>
<span><span class="co">##   summarize_colvars(.stats = c("n", "mean_sd")) %&gt;%</span></span>
<span><span class="co">##   build_table(df = adlb)</span></span></code></pre></div>
<p>The two expressions can be executed and return the
<code>rtables</code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_exec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">eval</span>, <span class="va">result</span><span class="op">)</span></span>
<span><span class="va">result_exec</span><span class="op">$</span><span class="va">rtables</span></span>
<span><span class="co">##                      A: Drug X              B: Placebo      </span></span>
<span><span class="co">##                  Value      Change       Value      Change  </span></span>
<span><span class="co">## â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></span>
<span><span class="co">## WEEK 1 DAY 8                                                </span></span>
<span><span class="co">##   n               69          69          73          73    </span></span>
<span><span class="co">##   Mean (SD)    1.0 (0.2)   0.0 (0.3)   1.0 (0.2)   0.0 (0.3)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="in-a-nutshell-1">In a nutshell<a class="anchor" aria-label="anchor" href="#in-a-nutshell-1"></a>
</h3>
<p>At this point, it is then possible to:</p>
<ul>
<li>generate <code>rtables</code> pipelines.</li>
<li>chain expressions in a pipeline (e.g.Â <code>pipe_expr</code>)</li>
<li>decompose a <code>rtables</code> pipeline to add
<strong>conditional</strong> layers (e.g.Â <code>.stats</code>).</li>
<li>group expressions into a single list and control both
<strong>pre-processing</strong> and <strong><code>rtables</code>
pipeline</strong>.</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>teal.modules.clinical is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>

  

  

  </body>
</html>
