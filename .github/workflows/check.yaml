name: Check ðŸ› 

on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review
    branches:
      - main
      - shinytest2@main
  push:
    branches:
      - main
      - shinytest2@main
  workflow_dispatch:

jobs:
  check:
    name: Check PR ðŸ› 
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/insightsengineering/rstudio:2024.05.05
    steps:
      - name: Checkout repo ðŸ›Ž
        uses: actions/checkout@v4
        with:
          ref: "${{ env.BRANCH_NAME }}"
          token: "${{ steps.github-token.outputs.token }}"
      - name: Determine modified files ðŸ“‹
        run: |
          MODIFIED_FILES=$(git diff --name-only ${{ github.event.pull_request.base.ref }} ${{ github.event.pull_request.head.sha }} | grep '^R/')
          if [ -z "$MODIFIED_FILES" ]; then
            echo "No R files changed"
          else
            echo "Modified R files:"
            echo "$MODIFIED_FILES"
          fi
      - name: Echo the modified files in R ðŸ“¢
        run: |
          base_branch="${{ github.event.pull_request.base.ref }}"
          git fetch origin $base_branch:$base_branch
          MODIFIED_FILES=$(git diff --name-only $base_branch ${{ github.event.pull_request.head.sha }} | grep '^R/' | sed 's/^R\///')
          if [ -z "$MODIFIED_FILES" ]; then
            echo "No R files changed"
          else
            echo "Modified R files:"
            echo "$MODIFIED_FILES"
          fi
